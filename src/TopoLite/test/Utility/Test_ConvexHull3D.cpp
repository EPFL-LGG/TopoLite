//
// Created by ziqwang on 2020-02-13.
//

#include <catch2/catch.hpp>
#include "Utility/ConvexHull3D.h"
#include <string>
#include <sstream>

bool compareListVector3(const std::vector<Eigen::Vector3d> &A, const std::vector<Eigen::Vector3d> &B)
{

    if(A.size() != B.size()) return false;

    for(int id = 0; id < A.size(); id++)
    {
        int jd = 0;
        for(; jd < B.size(); jd++){
            if(Approx(0) == (A[id] - B[jd]).norm()){
                break;
            }
        }

        if(jd == B.size())
            return false;
    }
    return true;

}

void string2ListVector3(std::string data, std::vector<Eigen::Vector3d> &pts)
{

    std::stringstream iss(data);
    double number;
    int index = 0;
    while(iss >> number){

        if(index % 3 == 0){
            pts.push_back(Eigen::Vector3d(0, 0, 0));
        }

        pts.back()[index % 3] = number;
        index += 1;
    }

    return;
}

void printListVector3(std::vector<Eigen::Vector3d> &list){
    for(Eigen::Vector3d pt : list){
        std::cout << pt.transpose() << std::endl;
    }
}

TEST_CASE("ConvexHull3D")
{
    std::string data = "0.3215426810286406 0.1678336189760208 -0.2203710966001927 \n"
                       "0.2229772524190855 -0.4213242506806965 -0.1966818060695024 \n"
                       "0.3688830163971363 -0.1831502133823468 -0.2056387967482571 \n"
                       "-0.1712592515826777 -0.3542439228428937 0.2223876390814666 \n"
                       "-0.3309556113844324 -0.370961861099081 0.2439994981922204  \n"
                       "-0.1004397059794885 -0.09014152417903909 -0.008600084584765189 \n"
                       "0.458374538420117 -0.09914027349943322 -0.2505798421339875     \n"
                       "-0.4954086979808367 -0.3339869997780649 -0.3195065691317492    \n"
                       "0.053091190339151 0.3036317017894533 0.1380056861210668\n"
                       "0.4615616439483703 0.4665423151725366 0.1766835406205464\n"
                       "-0.4797380864431505 0.0419809916447671 -0.4254776681079321\n"
                       "-0.003168473023146823 -0.2525299883005488 -0.27151530400991\n"
                       "-0.3577162826971303 -0.1375644040643837 -0.04494194644032229\n"
                       "-0.3392973838740004 0.4288679723896719 -0.01599531622230571\n"
                       "0.1667164640191164 0.003605551555385444 -0.4014989499947977\n"
                       "0.00714666676441833 0.1140243407469469 0.407090128778564\n"
                       "-0.03621271768232132 0.3728502838619522 0.4947140370446388\n"
                       "-0.3411871756810576 -0.3328629143842151 -0.4270033635450559\n"
                       "0.3544683273457627 -0.450828987127942 -0.0827870439577727\n"
                       "-0.4018510635028137 0.08917494033386464 -0.2367824197158054\n"
                       "0.3978697768392692 -0.002667689232777493 0.1641431727112673\n"
                       "-0.245701439441835 0.495905311308713 -0.3194406286994373\n"
                       "0.161352035739787 -0.1563404972258401 0.3852604361113724\n"
                       "0.07214279572678994 -0.4960366976410492 0.1112227161519441\n"
                       "0.3201855824516951 0.359077846965825 0.02136723140381946\n"
                       "0.1190541238701475 -0.05734495917087884 0.2032677509852384\n"
                       "0.3210853052521919 0.4807189479290684 0.4433501688235907\n"
                       "0.3862800354941562 0.2085496142586224 0.09336129957191763\n"
                       "0.1233572616459404 0.265491605052251 0.117400122450106\n"
                       "0.1438531872293476 -0.2594872752758556 -0.2026374435076839\n"
                       "0.2724846394476338 -0.3506708492996831 0.2750346518820475\n"
                       "-0.4926118841325975 -0.3279366743079728 0.3683135596740186\n"
                       "0.2459906458351674 0.3647787136629026 -0.1641662355178652\n"
                       "-0.141922976953837 -0.2994764654892278 -0.3009570467294725\n"
                       "-0.1850859398814719 0.2606059478228967 0.004159106876849283\n"
                       "-0.09789466634196664 -0.3156603563722785 -0.303610991503681\n"
                       "0.2100642609503719 -0.4499717643018549 0.3245569875692548\n"
                       "-0.1707163766685095 -0.2301452446078371 -0.05112823569320907\n"
                       "-0.312260808713977 -0.1674135249735914 0.2808831662692904\n"
                       "-0.1966306233747216 0.2291105671125563 -0.3387042454804333";

    std::string result = "0.3215426810286406 0.1678336189760208 -0.2203710966001927 \n"
                         "0.2229772524190855 -0.4213242506806965 -0.1966818060695024 \n"
                         "0.458374538420117 -0.09914027349943322 -0.2505798421339875 \n"
                         "-0.4954086979808367 -0.3339869997780649 -0.3195065691317492 \n"
                         "0.4615616439483703 0.4665423151725366 0.1766835406205464 \n"
                         "-0.4797380864431505 0.0419809916447671 -0.4254776681079321 \n"
                         "-0.3392973838740004 0.4288679723896719 -0.01599531622230571 \n"
                         "0.1667164640191164 0.003605551555385444 -0.4014989499947977 \n"
                         "-0.03621271768232132 0.3728502838619522 0.4947140370446388 \n"
                         "-0.3411871756810576 -0.3328629143842151 -0.4270033635450559 \n"
                         "0.3544683273457627 -0.450828987127942 -0.0827870439577727 \n"
                         "0.3978697768392692 -0.002667689232777493 0.1641431727112673 \n"
                         "-0.245701439441835 0.495905311308713 -0.3194406286994373 \n"
                         "0.161352035739787 -0.1563404972258401 0.3852604361113724 \n"
                         "0.07214279572678994 -0.4960366976410492 0.1112227161519441 \n"
                         "0.3210853052521919 0.4807189479290684 0.4433501688235907 \n"
                         "0.2724846394476338 -0.3506708492996831 0.2750346518820475 \n"
                         "-0.4926118841325975 -0.3279366743079728 0.3683135596740186 \n"
                         "0.2459906458351674 0.3647787136629026 -0.1641662355178652 \n"
                         "0.2100642609503719 -0.4499717643018549 0.3245569875692548";

    ConvexHull3D<double>::ListVector3 pts,resPts;
    string2ListVector3(data, pts);
    string2ListVector3(result, resPts);

    ConvexHull3D<double> convexhull3d;

    ConvexHull3D<double>::ListVector3 outPts;
    ConvexHull3D<double>::ListVector3i outTri;
    convexhull3d.computeQuickHull(pts, outPts, outTri);

    REQUIRE(compareListVector3(outPts, resPts) == true);

}






